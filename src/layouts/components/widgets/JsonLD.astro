---
import { absoluteUrl } from "@/lib/utils/absoluteUrl";
import JsonLdGenerator from "@/lib/utils/JsonLdGenerator";
import { supportedLanguages } from "@/lib/utils/languageParser";
import parseTomlToJson from "@/lib/utils/parseTomlToJson";

const config = parseTomlToJson("./src/config/config.toml");
const { content } = Astro.props;

let {
  title = config.site.title,
  metaTitle = title,
  description = config.site.description,
  metaDescription = description,
  image = config.opengraph.image,
  taglineSeparator = " - ",
  disableTagline,
  canonical,
  lang,
  author = config.seo.author,
  structuredData,
  includeLocalBusiness = false,
} = content;

title =
  !disableTagline && metaTitle ? metaTitle : title ? title : config.site.title;

// Add tagline & separator to title
// prettier-ignore
const alternateLangs =  config.settings.multilingual.enable ? supportedLanguages : []
title += config.site.tagline ? taglineSeparator + config.site.tagline : "";
description = metaDescription ? metaDescription : description;
canonical = canonical ? canonical : Astro.url.href;
lang = Astro.currentLocale;
image = absoluteUrl(image, Astro);

// Generate JSON-LD dynamically
const jsonLdData = JsonLdGenerator(
  {
    ...content,
    ...structuredData,
    title,
    description,
    image,
    canonical,
    config,
    author,
    lang,
    alternateLangs,
  },
  Astro,
);

// LocalBusiness / ProfessionalService schema for homepage and contact pages
const localBusinessSchema = includeLocalBusiness
  ? {
      "@context": "https://schema.org",
      "@type": "ProfessionalService",
      name: "BVS Web Design",
      url: "https://www.bvswebdesign.co.uk/",
      description:
        "Freelance web designer and developer based in Skipton, North Yorkshire. WordPress websites, custom web applications, SEO audits and hosting.",
      address: {
        "@type": "PostalAddress",
        addressLocality: "Skipton",
        addressRegion: "North Yorkshire",
        addressCountry: "GB",
      },
      areaServed: [
        "Skipton",
        "Keighley",
        "Ilkley",
        "North Yorkshire",
        "Yorkshire",
      ],
      founder: {
        "@type": "Person",
        name: "Steve Marks",
      },
      sameAs: [
        "https://www.facebook.com/bvswebdesign",
        "https://www.linkedin.com/company/bvswebdesign/",
        "https://www.google.com/maps/place/BVSWebDesign/@53.9319542,-2.0003864,17z/",
      ],
    }
  : null;
---

<!-- JSON-LD -->{
  content ? (
    <script
      type="application/ld+json"
      is:inline
      set:html={JSON.stringify(jsonLdData, null, 2)}
    />
  ) : null
}
{
  localBusinessSchema ? (
    <script
      type="application/ld+json"
      is:inline
      set:html={JSON.stringify(localBusinessSchema, null, 2)}
    />
  ) : null
}
